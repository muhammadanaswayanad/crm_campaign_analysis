<?xml version="1.0" encoding="UTF-8"?>
<templates xml:space="preserve">
    <!-- Main template for the view -->
    <t t-name="CampaignAnalysisCustomView">
        <div class="o_campaign_analysis_view">
            <div class="o_content"/>
        </div>
    </t>

    <!-- Template for the buttons -->
    <t t-name="CampaignAnalysisCustomViewButtons">
        <div class="o_campaign_analysis_buttons">
            <button type="button" class="btn btn-primary o_campaign_analysis_refresh">
                <i class="fa fa-refresh"/> Refresh
            </button>
        </div>
    </t>

    <!-- Template for the table -->
    <t t-name="CampaignAnalysisTableTemplate">
        <div class="table-responsive">
            <table class="table table-bordered table-hover">
                <thead>
                    <tr>
                        <th>Campaign</th>
                        <t t-foreach="Object.entries(stages)" t-as="stage">
                            <th><t t-esc="getStageDisplay(stage[1])"/> (%)</th>
                        </t>
                        <th>Total Leads</th>
                    </tr>
                </thead>
                <tbody>
                    <t t-foreach="Object.entries(campaigns)" t-as="campaign">
                        <tr>
                            <td><t t-esc="campaign[1].name"/></td>
                            <t t-foreach="Object.entries(stages)" t-as="stage">
                                <t t-set="stageInfo" t-value="campaign[1].stages[stage[0]] || {percentage: 0.0, lead_count: 0}"/>
                                <td t-att-class="shouldHighlight(getStageDisplay(stage[1]), stageInfo.percentage) ? 'bg-danger' : ''">
                                    <t t-esc="formatPercentage(stageInfo.percentage)"/>
                                </td>
                            </t>
                            <td><t t-esc="campaign[1].total_leads"/></td>
                        </tr>
                    </t>
                </tbody>
            </table>
        </div>
        <div class="mt-3">
            <h5>Highlighting Rules:</h5>
            <ul>
                <li>Red: JUNK > 20%</li>
                <li>Red: Not Connected (NC) > 20%</li>
                <li>Red: Admission (A) &lt; 5%</li>
                <li>Red: Hot Prospect (HP) or Future Prospect (FP) &lt; 5%</li>
            </ul>
        </div>
    </t>
</templates>
